MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;***************************************************************
                      00002                         list    p=16F88
                      00003                         #include        <p16F88.inc>
                      00001         LIST
                      00002 ; P16F88.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00401         LIST
                      00004 ;***************************************************************
                      00005 BANCO0          MACRO                           ; todos los 16F88 son capaces de direccionar bloque un b
                            loque de 8K continuos de palabra de memoria de programa
                      00006                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
                      00007                         BCF     STATUS,RP1      ; de memoria de programa de 2K
                      00008                         ENDM                            ; PCL tiene 11 bits para direccionar la memoria 
                            de programa, 2^11 = 2048 
                      00009 BANCO1          MACRO                           ; Cuando se hace una instruccion CALL o GOTO, los dos bi
                            ts mas signifitivos de la direccion son entregados 
                      00010                         BSF     STATUS,RP0      ; por PCLATH<4:3>
                      00011                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
                      00012                         ENDM                            ; son programados, asi la pagina de la memoria d
                            e programa deseada es direccionada.
                      00013 BANCO2          MACRO                           ; si un retorno de una instruccion CALL (o interrupcion 
                            ) es ejecutada. Los 13 bits del PC son POPPED OFF
                      00014                         BCF     STATUS,RP0      ; de la pila. Por lo tanto, la manipulacion de los bits 
                            PCLATH<4:3> no son requeridas por la instruccion RETURN
                      00015                         BSF     STATUS,RP1      ; (el cual POPS la direccion desde la pila)
                      00016                         ENDM                                    
                      00017 BANCO3          MACRO                           ; OJO: el contenido del registro PCLATH se mantiene sin 
                            cambios despues de una instruccion RETURN, RETFIE
                      00018                         BSF     STATUS,RP0      ; ejecutada. El usuario debe reescribir el contenido de 
                            el registro PCLATH para alguna subsecuente llamada
                      00019                         BSF     STATUS,RP1      ; de subrutina o instruccion GOTO.
                      00020                         ENDM
                      00021 ;****************************************************************
                      00022                                 ; PC de 13 bits                                                 ; PC    
                            LATH     | 4 | 3 |              PCL     |7|6|5|4|3|2|1|0|       11 bits del PROGRAM COUNTER (PC)
                      00023                                 ; MEMORIA                       PAGINA 0                        ----> 00
                            05 a la 07FF            05     a la 2047
                      00024         ; 4K x 14               ; DE PROGRAMA           PAGINA 1                        ----> 0800 a la 
                            0FFF            2048 a la 4095                          2048 a la ( 2^11 = 2048 ) x 2 = 4096 pal
                      00025                                 ; MEMORIA
                      00026         ;4K x 14                ; DE DATOS                                      CATALOGADA EN 4 BANCOS  
                            -----> 00 a la 1FF                                      
                      00027         
                      00028         ;14 es la amplitud del bus de la memoria de programa
                      00029 ;****************************************************************
  00000024            00030 UNI                             equ     24h     ; RECORDATORIO DE EN DONDE SE ENCUENGRAN ALGUNOS REGISTR
                            OS 
  00000025            00031 DECE                    equ     25h     ;       ADRESH  1Eh             banco 0
  00000026            00032 SP                              equ     26h     ;       ADRESL  9Eh             banco 1
  00000027            00033 uni_comodin             equ     27h     ;       ANSEL           9Bh             banco 1
  00000028            00034 dece_comodin    equ     28h     ;       ADCON0  1Fh             banco 0
  00000029            00035 STATUS_TEMP     equ 29h ;       ADCON1  9Fh             banco 1
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000002A            00036 PCLATH_TEMP     equ 2Ah ;****************************************************************
  0000002B            00037 W_TEMP          equ     2Bh
                      00038 ;**************************************************
  0000002C            00039 BINARIO                 equ     2Ch
  0000002D            00040 CONTADOR1       equ 2Dh
  0000002E            00041 CONTADOR2       equ 2Eh
  0000002F            00042 CONTADOR3       equ 2Fh
                      00043 ;********************** 
  00000030            00044 BCDH                    equ 30h
  00000031            00045 BCDL                    equ 31h
  00000032            00046 BCD_TEMP                equ 32h
                      00047 
  00000034            00048 BIN                             equ 34h
  00000035            00049 BIN_comodin             equ 35h
  00000036            00050 T_ADQ                   equ 36h
                      00051 ;*************************************************
  00000037            00052 SEIS_CERO               equ     37h
  00000038            00053 NUEVE_NUEVE     equ  38h
                      00054 ;***************************************************************
  00000039            00055 DECE_com                equ     39h
  0000003A            00056 CUENTA_SP1      equ 3Ah
  0000003B            00057 CUENTA_SP2      equ 3Bh
  0000003C            00058 CUENTA_SP3      equ 3Ch
  0000003D            00059 CUENTA_SP4      equ 3Dh
  0000003E            00060 REG_REBOTE1     equ 3Eh
  0000003F            00061 REG_REBOTE2     equ     3Fh
  00000040            00062 RETARDO_PULSO           equ     40h
                      00063 
  00000042            00064 RETARDO_PULSO_com       equ 42h
  00000043            00065 CICLOS60                                equ 43h
  00000044            00066 CUENTA                          equ 44h
  00000033            00067 CUENTA100               equ 33h
  00000041            00068 CONTADOR_D_PULS equ 41h
                      00069 
                      00070 ;#######################################################################################################
                            ############################
0000                  00071                         ORG             0x00
0000   2805           00072                         GOTO            INICIO
0004                  00073                         ORG             0x04
0004   2900           00074                         GOTO            SP_INTERRUPT
                      00075 ;#######################################################################################################
                            ############################
0005                  00076                         ORG             0x05
0005   2218           00077 INICIO          CALL            limpia_registros
0006   2231           00078                         CALL            configura_oscilador
                      00079                         ;CALL           configura_TMR0
                      00080                         ;CALL           configura_comparadores  ; un comparador independiente
0007   2236           00081                         CALL            configura_puertos
                      00082                         ;CALL           configura_convertidor
0008   223D           00083                         CALL            configura_interrupciones
                      00084                         ;----------  PROGRAMA PRINCIPAL -  ---------------------------------------------
                            ----------------------------
                      00085                         
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00086                                         ;---------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
                      00087                                         BANCO0
0009   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
000A   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
000B   01C1           00088                                         CLRF            CONTADOR_D_PULS
000C   3058           00089                                         MOVLW           H'58'                                           
                            ; 88 decimal = 58h
000D   00B3           00090                                         MOVWF           CUENTA100
                      00091                                         
000E   3058           00092                                         MOVLW           H'58'                                           
                            ; 60 decimal                            ; dice cuantas veces hara el mismo retardo      
000F   00C3           00093                                         MOVWF           CICLOS60
                      00094                                         
0010   1B85           00095 REVISA_CRUCEx0  BTFSC           PORTA,7                         ; monitorea el pulso de cruce por cero
0011   2810           00096                                         GOTO            REVISA_CRUCEx0          ; monitorea el pulso de 
                            cruce por cero
0012   1205           00097                                         BCF             PORTA,4
                      00098                                         
0013   0833           00099                                         MOVF            CUENTA100,0                     ; la primera vez
                             mueve un 88 al registro W
0014   00C0           00100                                         MOVWF           RETARDO_PULSO           ; mueve el 88 al registr
                            o RETARDO de PULSO
0015   2475           00101 HAZ                                     CALL            t83_micros                      
0016   0BC0           00102                                         DECFSZ  RETARDO_PULSO,1         ; decrementa el registro y almac
                            enalo en el mismo       
0017   2815           00103                                         GOTO            HAZ
Message[305]: Using default destination of 1 (file).
0018   0AC1           00104                                         INCF            CONTADOR_D_PULS                                 
                                                                                                    ; 8.333 [ms]/100 = 83.33
                      00105 
0019   1605           00106                                         BSF             PORTA,4                         ; TERCERO: APARE
                            CE EL PULSO 
001A   2451           00107                                         CALL            t1_ms                                   ; CUARTO
                            : DURACION DEL PULSO DE  1 ms
001B   1205           00108                                         BCF             PORTA,4                         ; QUINTO: DESAPA
                            RECE EL PULSO, Y 
                      00109 
001C   0BC3           00110                                         DECFSZ  CICLOS60,1
001D   2824           00111                                         GOTO            SALIR_AOTRO     
                      00112 
001E   3058           00113                                         MOVLW           H'58'
001F   00C3           00114                                         MOVWF           CICLOS60                
0020   2821           00115                                         GOTO            DEC_CUENTA
                      00116                 
0021   0BB3           00117 DEC_CUENTA              DECFSZ  CUENTA100,1
0022   2824           00118                                         GOTO            SALIR_AOTRO
0023   2825           00119                                         GOTO            FINALIZA
0024   2810           00120 SALIR_AOTRO             GOTO            REVISA_CRUCEx0          ; SEXTO: ESPERA UN NUEVO CRUCE POR CERO
                      00121 
0025   1205           00122 FINALIZA                        BCF             PORTA,4
0026   2825           00123                                         GOTO            FINALIZA
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00124 
                      00125 
                      00126 
                      00127 
                      00128 
                      00129 
                      00130 
                      00131 
                      00132 
                      00133 
                      00134 ;REVISA_CRUCEx0 BANCO0
                      00135 ;                                       BTFSC           PORTA,7                         ; monitorea el p
                            ulso de cruce por cero
                      00136 ;                                       GOTO            REVISA_CRUCEx0          ; monitorea el pulso de 
                            cruce por cero
                      00137                                                                                                         
                                    ; PRIMERO: DETECTA EL PULSO
                      00138 ;                                       BCF             PORTA,4                         ; apago el pulso
                             por si se mantuvo encendido                                                                    
                      00139 ;                                       BTFSS           CONTADOR1,0
                      00140 ;                                       GOTO            INC_VELOCIDAD
                      00141 ;                                       GOTO            DEC_VELOCIDAD
                      00142                                         ;_______________________________________________________________
                            ________________________                                        
                      00143 ;INC_VELOCIDAD  CALL            retraso8333msVarINC     ; SEGUNDO: ENVIA UN TIEMPO DE RETARDO (SERA VARI
                            ABLE), 
                      00144 ;                                       GOTO            CONTINUA_OP
                      00145                                         ;_______________________________________________________________
                            ________________________                                        
                      00146 ;DEC_VELOCIDAD  CALL            retraso8333msVarDEC     ; SEGUNDO: ENVIA UN TIEMPO DE RETARDO (SERA VARI
                            ABLE), 
                      00147 ;                                       GOTO            CONTINUA_OP
                      00148                                         ;_______________________________________________________________
                            ________________________                                        
                      00149 ;CONTINUA_OP            BSF             PORTA,4                         ; TERCERO: APARECE EL PULSO 
                      00150 ;                                       CALL            un_ms                                   ; CUARTO
                            : DURACION DEL PULSO DE  1 ms
                      00151 ;                                       BCF             PORTA,4                         ; QUINTO: DESAPA
                            RECE EL PULSO, Y 
                      00152 ;                                       GOTO            REVISA_CRUCEx0          ; SEXTO: ESPERA UN NUEVO
                             CRUCE POR CERO
                      00153 ;#######################################################################################################
                            #############
                      00154 ;{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{  SUBRUTINA DE INTERR
                            UPCION }}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}
0100                  00155                                 ORG             0x100
0100   00AB           00156 SP_INTERRUPT    MOVWF   W_TEMP          ;Copy W to TEMP register                                        
                                                    ;codigo propuesto por hoja de especificaciones
0101   0E03           00157                                 SWAPF           STATUS,0                ;Swap status to be saved into W 
                                                                            ;codigo propuesto por hoja de especificaciones
0102   0183           00158                                 CLRF            STATUS          ;bank 0, regardless of current bank, Cle
                            ars IRP,RP1,RP0 ;codigo propuesto por hoja de especificaciones
0103   00A9           00159                                 MOVWF   STATUS_TEMP     ;Save status to bank zero STATUS_TEMP register  
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                                            ;codigo propuesto por hoja de especificaciones
                      00160                                 ;MOVF           PCL,0                   ;Only required if using page 1  
                                                                            ;codigo propuesto por hoja de especificaciones
                      00161                                 ;MOVWF  PCLATH_TEMP     ;Save PCLATH into W                             
                                                                    ;codigo propuesto por hoja de especificaciones
                      00162                                 ;CLRF           PCL                     ;Page zero, regardless of curren
                            t page                                  ;codigo propuesto por hoja de especificaciones
                      00163                                 ; ================================================
0104   3009           00164 INICIA_SP               MOVLW           H'09'
0105   00A4           00165                                 MOVWF           UNI
0106   00A5           00166                                 MOVWF           DECE
                      00167                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0107   224D           00168                                 CALL            desplegar_u_bcd
0108   2257           00169                                 CALL            desplegar_d_bcd
                      00170                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0109   30FF           00171 OTRA_VEZ                MOVLW           H'FF'                                           ;(1)
010A   00BA           00172                                 MOVWF           CUENTA_SP1                              ;(1)
010B   30FF           00173                                 MOVLW           H'FF'                                           ;(1)
010C   00BB           00174                                 MOVWF           CUENTA_SP2                              ;(1)
010D   3008           00175                                 MOVLW           H'08'                                           ;(1)    
                            ;carga un  decimal
010E   00BC           00176                                 MOVWF           CUENTA_SP3                              ;(1)
                      00177                                 ;MOVLW          H'01'                                   ;(1)    ;carga u
                            n  decimal
                      00178                                 ;MOVWF          CUENTA_SP4                      ;(1)
                      00179                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
010F   1E06           00180 REVISA_U                BTFSS           PORTB,4                         ;(1)
0110   2913           00181                                 GOTO            REVISA_D                                ;(2)
0111   2200           00182                                 CALL            configura_unidades                      
0112   2909           00183                                 GOTO            OTRA_VEZ
0113   1C85           00184 REVISA_D                BTFSS           PORTA,1                         ;(1)
0114   2917           00185                                 GOTO            QUITA_TIEMPO                    ;(2)
0115   220C           00186                                 CALL            configura_decenas
0116   2909           00187                                 GOTO            OTRA_VEZ                
0117   0BBA           00188 QUITA_TIEMPO    DECFSZ  CUENTA_SP1,1                    ;(1)
0118   290F           00189                                 GOTO            REVISA_U                                ;(2)
0119   0BBB           00190                                 DECFSZ  CUENTA_SP2,1                    ;(1)
011A   290F           00191                                 GOTO            REVISA_U                                ;(2)
011B   0BBC           00192                                 DECFSZ  CUENTA_SP3,1                    ;(1)
011C   291D           00193                                 GOTO            ACCION_out                              ;(2)
                      00194                                 ;DECFSZ CUENTA_SP4,1                    ;(1)
                      00195                                 ;GOTO           ACCION_out                              ;(2)
                      00196                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
                      00197 ACCION_out              BANCO0
011D   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
011E   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
011F   3006           00198                                 MOVLW           H'06'                   ; 
0120   00BA           00199                                 MOVWF           CUENTA_SP1      ; 
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0121   224D           00200 CIRCULOSP               CALL            desplegar_u_bcd  ;despliega UNI
0122   2257           00201                                 CALL            desplegar_d_bcd ; despliega DECE
0123   2430           00202                                 CALL            tmedio_s                ; RETARDO DE MEDIO SEGUNDO
0124   30FF           00203                                 MOVLW           H'FF'                   ; despliega NADA 
0125   0086           00204                                 MOVWF           PORTB                   ; despliega NADA 
0126   1705           00205                                 BSF             PORTA,6         ; despliega NADA 
0127   2430           00206                                 CALL            tmedio_s        ; RETARDO DE MEDIO SEGUNDO
0128   0BBA           00207                                 DECFSZ  CUENTA_SP1,1    ;                       
0129   2921           00208                                 GOTO            CIRCULOSP
                      00209                                 ; ========== recuperacion de reg import =============
                      00210                                 ;MOVF           PCLATH_TEMP,0           ;Restore PCLATH                 
                                                    ;codigo propuesto por hoja de especificaciones
                      00211                                 ;MOVWF  PCL                                     ;Move W into PCLATH     
                                                            ;codigo propuesto por hoja de especificaciones
012A   0E29           00212 SIGUEPROG               SWAPF           STATUS_TEMP,0           ;Swap STATUS_TEMP register into W       
                            ;codigo propuesto por hoja de especificaciones
                      00213                                                                                                         
                            ;(sets bank to original state)                                  ;codigo propuesto por hoja de es
012B   0083           00214                                 MOVWF   STATUS                          ;Move W into STATUS register    
                                            ;codigo propuesto por hoja de especificaciones
012C   0EAB           00215                                 SWAPF           W_TEMP,1                                ;Swap W_TEMP    
                                                                    ;codigo propuesto por hoja de especificaciones
012D   0E2B           00216                                 SWAPF           W_TEMP,0                                ;Swap W_TEMP int
                            o W                             ;codigo propuesto por hoja de especificaciones
                      00217                                 ;==============================================
012E   108B           00218                                 BCF             INTCON,1                                ;limpia bandera 
                            de interrupcion RB0                                             
012F   0009           00219                                 RETFIE                                                          ;regresa
                             de la interrupcion
                      00220 ;}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}} TERMINA SUBRUTINA DE INTERRU
                            PCION }}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}
                      00221 
                      00222 ;#############SUBRUTINAS DE RETRASO DE TIEMPO###########################################################
                            #######################################
0400                  00223                                                 ORG             0x400                           ; 1024
                      00224 ;##########################################################################################
                      00225 retraso8333msVarINC     BANCO1
0400   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
0401   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0402   1281           00226                                                 BCF             OPTION_REG,5            ; 0 = Internal i
                            nstruction cycle clock (CLKO)   |
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0403   1181           00227                                                 BCF             OPTION_REG,3            ; 0= pre scaler 
                            asignado al TMR0                        |       
                      00228                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0404   1501           00229                                                 BSF             OPTION_REG,2            ; PS<2:0>: Presc
                            aler Rate Select bits           | QUITAR contar estos microsegundos
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0405   1081           00230                                                 BCF             OPTION_REG,1            ; 101           
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            1:64                                            | en el retardo
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0406   1401           00231                                                 BSF             OPTION_REG,0            ; preescalador a
                             64                                             |
                      00232                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
                      00233                                                 BANCO0
0407   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0408   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0409   0840           00234                                                 MOVF            RETARDO_PULSO,0 ;TMR0 =         [255 - {
                            (fxt)(temporizacion deseada)}/(4*divisor de frecuencia)]
040A   0081           00235                                                 MOVWF           TMR0                            ; 8.333 
                            [ms] -->        
040B   1D0B           00236 AGUANTAretraso8i                BTFSS           INTCON,T0IF                     ; TMR0 =        [255 - {
                            (4MHz)(8.333ms)}/(4*64)] = 255 - 130 = 124d = 7Ch
040C   2C0B           00237                                                 GOTO            AGUANTAretraso8i
                      00238                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
040D   1103           00239                                                 BCF             STATUS,2
040E   0AC0           00240                                                 INCF            RETARDO_PULSO,1 ; incrementa registro, y
                             el resultado lo vuelve a poner en el registro.                 
040F   1D03           00241                                                 BTFSS           STATUS,2                        ; verifi
                            ca si se puso la bandera Z a 1
0410   2C14           00242                                                 GOTO            salidaRetrasoINC
                      00243                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0411   142D           00244                                                 BSF             CONTADOR1,0                             
                                            
0412   30FF           00245                                                 MOVLW            H'FF'
0413   00C0           00246                                                 MOVWF           RETARDO_PULSO
                      00247                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0414   110B           00248 salidaRetrasoINC                        BCF             INTCON,T0IF                     ; limpiar bander
                            a 
0415   0008           00249                                                 RETURN                                          ;Cuando 
                            se carga un valor en el registro TMR0 (se escribe mediante una
                      00250                                                                                                         
                                    ;instrucción), se produce un retardo de dos ciclos de instrucción durante los
                      00251                                                                                                         
                                    ;cuales se inhibe tanto el prescaler como TMR0. Será necesario tener en cuenta
                      00252                                                                                                         
                                    ;esa inhibición temporal a la hora de realizar una precarga (compensar sumando
                      00253                                                                                                         
                                    ;los ciclos de instrucción que “se pierden”)
                      00254 ;#######################################################################################################
                            ############################################
                      00255 retraso8333msVarDEC     BANCO1
0416   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
0417   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0418   1281           00256                                                 BCF             OPTION_REG,5            ; 0 = Internal i
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            nstruction cycle clock (CLKO)   |
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0419   1181           00257                                                 BCF             OPTION_REG,3            ; 0= pre scaler 
                            asignado al TMR0                        |       
                      00258                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
041A   1501           00259                                                 BSF             OPTION_REG,2            ; PS<2:0>: Presc
                            aler Rate Select bits           | QUITAR contar estos microsegundos
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
041B   1081           00260                                                 BCF             OPTION_REG,1            ; 101           
                            1:64                                                    | en el retardo
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
041C   1401           00261                                                 BSF             OPTION_REG,0            ;               
                                                                                            |
                      00262                                                 BANCO0
041D   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
041E   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
                      00263                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
041F   0840           00264                                                 MOVF            RETARDO_PULSO,0 ;TMR0 =         [255 - {
                            (fxt)(temporizacion deseada)}/(4*divisor de frecuencia)]
0420   0081           00265                                                 MOVWF           TMR0                            ; 8.333 
                            [ms] -->        
0421   1D0B           00266 AGUANTAretraso8d                BTFSS           INTCON,T0IF                     ; TMR0 =        [255 - {
                            (4MHz)(8.333ms)}/(4*64)] = 255 - 130 = 124d = 7Ch
0422   2C21           00267                                                 GOTO            AGUANTAretraso8d
                      00268                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0423   03C0           00269                                                 DECF            RETARDO_PULSO,1 ; incrementa registro, y
                             el resultado lo vuelve a poner en el registro.                 
0424   1103           00270                                                 BCF             STATUS,2
0425   0840           00271                                                 MOVF            RETARDO_PULSO,0
0426   00C2           00272                                                 MOVWF           RETARDO_PULSO_com
0427   307C           00273                                                 MOVLW           H'7C'                                   
                                    
0428   0242           00274                                                 SUBWF           RETARDO_PULSO_com,0                     
                                    
0429   1D03           00275                                                 BTFSS           STATUS,2                        ; verifi
                            ca si se puso la bandera Z a 1
042A   2C2E           00276                                                 GOTO            salidaRetrasoDEC
                      00277                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
042B   102D           00278                                                 BCF             CONTADOR1,0
042C   307C           00279                                                 MOVLW            H'7C'
042D   00C0           00280                                                 MOVWF           RETARDO_PULSO                           
                                            
                      00281                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
042E   110B           00282 salidaRetrasoDEC                BCF             INTCON,T0IF                     ; limpiar bandera 
042F   0008           00283                                                 RETURN                                          ;Cuando 
                            se carga un valor en el registro TMR0 (se escribe mediante una
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00284                                                                                                         
                                    ;instrucción), se produce un retardo de dos ciclos de instrucción durante los
                      00285                                                                                                         
                                    ;cuales se inhibe tanto el prescaler como TMR0. Será necesario tener en cuenta
                      00286                                                                                                         
                                    ;esa inhibición temporal a la hora de realizar una precarga (compensar sumando
                      00287                                                                                                         
                                    ;los ciclos de instrucción que “se pierden”)
                      00288 ;#######################################################################################################
                            ############
0430   243B           00289 tmedio_s                CALL            t50msTMR0
0431   243B           00290                                 CALL            t50msTMR0                       ;100 ms
0432   243B           00291                                 CALL            t50msTMR0
0433   243B           00292                                 CALL            t50msTMR0                       ;200 ms
0434   243B           00293                                 CALL            t50msTMR0
0435   243B           00294                                 CALL            t50msTMR0                       ; 300 ms
0436   243B           00295                                 CALL            t50msTMR0
0437   243B           00296                                 CALL            t50msTMR0                       ; 400 ms 
0438   243B           00297                                 CALL            t50msTMR0
0439   243B           00298                                 CALL            t50msTMR0                       ; 500 ms
043A   0008           00299                                 RETURN
                      00300 ;#######################################################################################################
                            ##############################
                      00301 t50msTMR0                               BANCO1
043B   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
043C   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
043D   1281           00302                                                 BCF             OPTION_REG,5            ; 0 = Internal i
                            nstruction cycle clock (CLKO)   |
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
043E   1181           00303                                                 BCF             OPTION_REG,3            ; 0= pre scaler 
                            asignado al TMR0                        |       
                      00304                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
043F   1501           00305                                                 BSF             OPTION_REG,2            ; PS<2:0>: Presc
                            aler Rate Select bits           | QUITAR contar estos microsegundos
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0440   1481           00306                                                 BSF             OPTION_REG,1            ; 111           
                            1:256                                           | en el retardo
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0441   1401           00307                                                 BSF             OPTION_REG,0            ; preescalador a
                             256                                            |
                      00308                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
                      00309                                                 BANCO0
0442   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0443   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0444   303C           00310 PRECARGA                                MOVLW            H'3C'                  ; 50ms -->
0445   0081           00311                                                 MOVWF           TMR0                    ;       TMR0 =  
                            [255 - {(fxt)(temporizacion deseada)}/(4*divisor de frecuencia)]
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0446   1D0B           00312 AGUANTAretraso50ms      BTFSS           INTCON,T0IF
0447   2C46           00313                                                 GOTO            AGUANTAretraso50ms
0448   110B           00314                                                 BCF             INTCON,T0IF             ; limpiar bander
                            a 
0449   0008           00315                                                 RETURN                                  ;Cuando se carga
                             un valor en el registro TMR0 (se escribe mediante una
                      00316                                                                                                         
                            ;instrucción), se produce un retardo de dos ciclos de instrucción durante los
                      00317                                                                                                         
                            ;cuales se inhibe tanto el prescaler como TMR0. Será necesario tener en cuenta
                      00318                                                                                                         
                            ;esa inhibición temporal a la hora de realizar una precarga (compensar sumando
                      00319                                                                                                         
                            ;los ciclos de instrucción que “se pierden”)
                      00320 ;#######################################################################################################
                            ################
044A                  00321 t_20micros
                      00322 t_adq_20micros                  BANCO0                                  ;selecciona banco 0
044A   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
044B   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
044C   3006           00323                                                 MOVLW           H'06'                   ; (1) ciclo de i
                            nstruccion
044D   00B6           00324                                                 MOVWF           T_ADQ                   ; (1)
044E   0BB6           00325 esp_t_adq                               DECFSZ  T_ADQ,1         ; (1)           el decremento lo pone en
                             el mismo registro
044F   2C4E           00326                                                 GOTO            esp_t_adq               ; (2)           
                                                    
0450   0008           00327                                                 RETURN                                  ; (2)           
                            20-4=16;          (3 ciclos)x(6)=18,         en realidad serian como 22 microsegundos
                      00328 ;#######################################################################################################
                            #########
                      00329 t1_ms                                   BANCO1                                  ; (2) CALL 
0451   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
0452   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0453   1281           00330                                                 BCF             OPTION_REG,5    ;(1)    ; 0 = Internal i
                            nstruction cycle clock (CLKO)   |
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0454   1181           00331                                                 BCF             OPTION_REG,3    ;(1)    ; 0= pre scaler 
                            asignado al TMR0                        |       
                      00332                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0455   1501           00333                                                 BSF             OPTION_REG,2    ;(1)    ; PS<2:0>: Presc
                            aler Rate Select bits           | QUITAR contar estos microsegundos
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0456   1481           00334                                                 BSF             OPTION_REG,1    ;(1)    ; 111           
                            1:256                                           | en el retardo
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0457   1401           00335                                                 BSF             OPTION_REG,0    ;(1)    ; preescalador a
                             256                                            |
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00336                                                 ;-------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
                      00337                                                 BANCO0
0458   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0459   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
045A   30FB           00338 PRECARGA_un_ms          MOVLW            H'FB'                  ;(1)    ; 
045B   0081           00339                                                 MOVWF           TMR0                    ;(1)    ;       
                            TMR0 =  [255 - {(fxt)(temporizacion deseada)}/(4*divisor de frecuencia)]
045C   1D0B           00340 AGUANTA_un_ms           BTFSS           INTCON,T0IF             ;(2) ;          TMR0 =  [255 - {(4MHz)(1
                            ms)}/(4*256)]= 255 - 3.9 = 255-4 = 251d=FB
045D   2C5C           00341                                                 GOTO            AGUANTA_un_ms           ;(2)
045E   110B           00342                                                 BCF             INTCON,T0IF             ;(1)    ; limpia
                            r bandera 
045F   0008           00343                                                 RETURN                                  ;(2)
                      00344                                                                                                         
                            ;Cuando se carga un valor en el registro TMR0 (se escribe mediante una
                      00345                                                                                                         
                            ;instrucción), se produce un retardo de dos ciclos de instrucción durante los
                      00346                                                                                                         
                            ;cuales se inhibe tanto el prescaler como TMR0. Será necesario tener en cuenta
                      00347                                                                                                         
                            ;esa inhibición temporal a la hora de realizar una precarga (compensar sumando
                      00348                                                                                                         
                            ;los ciclos de instrucción que “se pierden”)
                      00349 ;#######################################################################################################
                            ########
                      00350 t100_micros             BANCO0                                  ;selecciona banco 0
0460   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0461   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0462   3020           00351                                 MOVLW           H'20'                   ; (1) ciclo de instruccion
0463   00B6           00352                                 MOVWF           T_ADQ                   ; (1)
0464   0BB6           00353 esp_100micros   DECFSZ  T_ADQ,1         ; (1)           el decremento lo pone en el mismo registro
0465   2C64           00354                                 GOTO            esp_100micros   ; (2)                                   
0466   0008           00355                                 RETURN                                  ; (2)           100-4=96;       
                              (3 ciclos)x(32)=96            32d=20h
                      00356 ;#######################################################################################################
                            ########
                      00357 t250_micros             BANCO0                                  ;selecciona banco 0
0467   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0468   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0469   3052           00358                                 MOVLW           H'52'                   ; (1) ciclo de instruccion
046A   00B6           00359                                 MOVWF           T_ADQ                   ; (1)
046B   0BB6           00360 esp_t250_micros DECFSZ  T_ADQ,1         ; (1)           el decremento lo pone en el mismo registro
046C   2C6B           00361                                 GOTO            esp_t250_micros ; (2)                                   
046D   0008           00362                                 RETURN                                  ; (2)           250-4=246;      
                              (3 ciclos)x(82)=246;  82d=52h
                      00363 ;#######################################################################################################
                            ########
                      00364 t600_micros             BANCO0                                  ;selecciona banco 0
046E   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            e direccion para permitir saltar dentro de alguna pagina de 
046F   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0470   30C7           00365                                 MOVLW           H'C7'                   ; (1) ciclo de instruccion
0471   00B6           00366                                 MOVWF           T_ADQ                   ; (1)
0472   0BB6           00367 esp_t600_micros DECFSZ  T_ADQ,1         ; (1)           el decremento lo pone en el mismo registro
0473   2C72           00368                                 GOTO            esp_t600_micros ; (2)                                   
0474   0008           00369                                 RETURN                                  ; (2)           600-4=596;      
                              (3 ciclos)x()=496;    199d=C7h
                      00370 ;#######################################################################################################
                            ########
                      00371 t83_micros              BANCO0                                  ;selecciona banco 0
0475   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0476   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0477   301A           00372                                 MOVLW           H'1A'                   ; (1) ciclo de instruccion
0478   00B6           00373                                 MOVWF           T_ADQ                   ; (1)
0479   0BB6           00374 esp_83micros    DECFSZ  T_ADQ,1         ; (1)           el decremento lo pone en el mismo registro
047A   2C79           00375                                 GOTO            esp_83micros    ; (2)                                   
047B   0008           00376                                 RETURN                                  ; (2)           83-4=79;        
                              (3 ciclos)x()=26.3333         26d=1Ah
                      00377 ;#######################################################################################################
                            ########
                      00378 ;######################SUBRUTINAS DE CONFIGURACION DE REGISTROS Y PERIFERICOS ##########################
                            #########################################################################
0200                  00379                                                 ORG             0x200
                      00380 ;------------ subrutina que configura unidades -------------------------------------------
                      00381 configura_unidades      BANCO0
0200   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0201   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
                      00382                                         ;CALL           REBOTE
Message[305]: Using default destination of 1 (file).
0202   0BA4           00383                                         DECFSZ  UNI
0203   2A08           00384                                         GOTO            SIGUE_U
0204   2A05           00385                                         GOTO            VUELVE_a9U
0205   224D           00386 VUELVE_a9U              CALL            desplegar_u_bcd
0206   3009           00387                                         MOVLW           H'09'
0207   00A4           00388                                         MOVWF           UNI             
0208   224D           00389 SIGUE_U                 CALL            desplegar_u_bcd
0209   1A05           00390 AUN_SIGUE_U             BTFSC           PORTA,4
020A   2A09           00391                                         GOTO            AUN_SIGUE_U
020B   0008           00392                                         RETURN
                      00393 ;------------ subrutina que configura decenas --------------------------------------------------
                      00394 configura_decenas       BANCO0
020C   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
020D   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
                      00395                                         ;CALL           REBOTE
Message[305]: Using default destination of 1 (file).
020E   0BA5           00396                                         DECFSZ  DECE
020F   2A14           00397                                         GOTO            SIGUE_D
0210   2A11           00398                                         GOTO            VUELVE_a9D
0211   2257           00399 VUELVE_a9D              CALL            desplegar_d_bcd
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0212   3009           00400                                         MOVLW           H'09'
0213   00A5           00401                                         MOVWF           DECE            
0214   2257           00402 SIGUE_D                 CALL            desplegar_d_bcd
0215   1A05           00403 AUN_SIGUE_D             BTFSC           PORTA,4
0216   2A15           00404                                         GOTO            AUN_SIGUE_D
0217   0008           00405                                         RETURN
                      00406 ;#######################################################################################################
                            ############
                      00407 limpia_registros                BANCO0
0218   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0219   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
021A   0185           00408                                         CLRF            PORTA                                           
                                    ; limpia puerto A
021B   0186           00409                                         CLRF            PORTB                                           
                                    ; limpia puerto B
                      00410                                         ;***************************************************************
                            *
021C   01A4           00411                                         CLRF            UNI                             
021D   01A5           00412                                         CLRF            DECE                    
021E   01A6           00413                                         CLRF            SP                              
021F   01A7           00414                                         CLRF            uni_comodin             
0220   01A8           00415                                         CLRF            dece_comodin    
0221   01A9           00416                                         CLRF            STATUS_TEMP     
0222   01AA           00417                                         CLRF            PCLATH_TEMP     
0223   01AB           00418                                         CLRF            W_TEMP          
                      00419                                         ;**************************************************
0224   01AC           00420                                         CLRF            BINARIO                 
0225   01AD           00421                                         CLRF            CONTADOR1       
0226   01AE           00422                                         CLRF            CONTADOR2       
0227   01AF           00423                                         CLRF            CONTADOR3       
                      00424                                         ;********************** 
0228   01B0           00425                                         CLRF            BCDH                    
0229   01B1           00426                                         CLRF            BCDL                    
022A   01B2           00427                                         CLRF            BCD_TEMP                
022B   01C4           00428                                         CLRF            CUENTA          
022C   01B4           00429                                         CLRF            BIN                             
022D   01B5           00430                                         CLRF            BIN_comodin                                     
                                            
                      00431                                                         
022E   01B7           00432                                         CLRF            SEIS_CERO               
022F   01B8           00433                                         CLRF            NUEVE_NUEVE
0230   0008           00434                                         RETURN
                      00435 ;#######################################################################################################
                            #########
                      00436 configura_oscilador     BANCO1                  ; selecciona Banco 1; Se encuentran registros TRISA y TR
                            ISB
0231   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
0232   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
                      00437                                                                                 ; al reset STATUS=000000
                            00
                      00438                                                                                 ; REGISTRO STATUS =     
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            IRP             RP1             RP0             T0_             PD_             Z               
                      00439                                                                                 ;  RP1 RP0
                      00440                                                                                 ;  0            0       
                                    banco 0
                      00441                                                                                 ;  0            1       
                                    banco 1         RP0=1
                      00442                                                                                 ;  1            0       
                                    banco 2
                      00443                                                                                 ;  1            1       
                                    banco 3
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0233   170F           00444                                         BSF     OSCCON,6        ;Pone el oscilador a 4 MHz con el oscila
                            dor interno RC; OSCCON controla varios aspectos de operacion del sistema de reloj; Banco 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0234   168F           00445                                         BSF     OSCCON,5        ;bit 6-4                110             
                            4 MHZ
                      00446                                                                                 ;al reset inicia con 0's
                             el registro.
0235   0008           00447                                         RETURN
                      00448 ;#######################################################################################################
                            ############################
                      00449 ;##### CONFIGURA LOS PUERTOS  A y B, (A0,A1,A2,A3 = ENTRADAS)  (A4,A5,A6,A7=SALIDAS),  (B0,B1,B2,B3 = EN
                            TRADAS)  (B4,B5,B6,B7=SALIDAS) ##################
                      00450 configura_puertos       BANCO1                                  ;;Puerto A como salida          0 - sali
                            da;     1 - entrada
0236   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
0237   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
0238   30AC           00451                                 MOVLW           B'10101100'             ; RA7   RA6             RA5     
                                    RA4             RA3             RA2             RA1             RA0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0239   0085           00452                                 MOVWF           TRISA                   ;    1            0             
                              1               0               1                1               1               1    
                      00453                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
023A   3001           00454                                 MOVLW           B'00000001'             ; RB7   RB6             RB5     
                                    RB4             RB3             RB2             RB1             RB0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
023B   0086           00455                                 MOVWF           TRISB                   ;    0            0             
                              0               0               0                0               0               1            
                      00456                                 ;-----------------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
023C   0008           00457                                 RETURN
                      00458 ;#######################################################################################################
                            ##############                                                  
                      00459 ;########################################### CONFIGURAR INTERRUPCIONES  ################################
                            #######################
                      00460 configura_interrupciones        BANCO1
023D   1683               M                         BSF     STATUS,RP0      ; por PCLATH<4:3>
023E   1303               M                         BCF     STATUS,RP1      ; Cuando se hace una instruccion CALL o GOTO, el usuario
                             debe asegurar que los bits seleccionados de la pagina
                      00461                 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

023F   1301           00462                                                 BCF             OPTION_REG,INTEDG                       
                                    ; activa por flanco de bajada, bit INTEDG
                      00463                                                 ;-----------------------------------------------------  
                            HABILITACION DE INTERRUPCIONES -----------------------------------------------------------------
0240   160B           00464                                                 BSF             INTCON, INTE                            
                                                    ; que sea interrupcion externa por RB0, bit INTE bit 4
0241   178B           00465                                                 BSF             INTCON, GIE                             
                                                    ; habilitamos interrupcion global GIE bit 7
                      00466                                                                                                         
                                                                    ; INTCON TAMBIEN ESTA EN BANCO 1
0242   0008           00467                                                 RETURN
                      00468 ;#######################################################################################################
                            ####################################;################################ PARA QUE NO SE PIERDA AQUI
                      00469 ; movemos el registro BCDL al puerto B y el bit0 del registro BCDL al pin1 del puerto A
                      00470 desplegar_bin_bcd       BANCO0
0243   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0244   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0245   0831           00471                                         MOVF            BCDL,0          ; mueve el reg BCDL al registro 
                            W
0246   0086           00472                                         MOVWF           PORTB           ; mueve el registro W al PORTB
0247   1C31           00473                                         BTFSS           BCDL,0          ; salta si hay un '1' en el bit0
                             del registro BCDL
0248   2A4B           00474                                         GOTO            pon_cero        ; salta a etiqueta SIGUE
0249   1705           00475                                         BSF             PORTA,6 ; pon un '1' en el pin1 del PUERTO A
024A   2A4C           00476                                         GOTO            termina
024B   1305           00477 pon_cero                        BCF             PORTA,6 ; pon un '0' en el pin1 del puerto A            
                                                    
024C   0008           00478 termina                         RETURN                                  
                      00479 ;###################################################################
                      00480 desplegar_u_bcd         BANCO0
024D   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
024E   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
024F   0824           00481                                         MOVF            UNI,0           ; mueve el reg UNI al registro W
0250   0086           00482                                         MOVWF           PORTB           ; mueve el registro W al PORTB
0251   1C24           00483                                         BTFSS           UNI,0           ; salta si hay un '1' en el bit0
                             del registro UNI
0252   2A55           00484                                         GOTO            pon_ceroU       ; salta a etiqueta SIGUE
0253   1705           00485                                         BSF             PORTA,6 ; pon un '1' en el pin1 del PUERTO A
0254   2A56           00486                                         GOTO            terminaU
0255   1305           00487 pon_ceroU                       BCF             PORTA,6 ; pon un '0' en el pin1 del puerto A            
                                                    
0256   0008           00488 terminaU                                RETURN                                  
                      00489 ;###################################################################
                      00490 desplegar_d_bcd         BANCO0
0257   1283               M                         BCF     STATUS,RP0      ; las instrucciones CALL and GOTO proveen solo 11 bits d
                            e direccion para permitir saltar dentro de alguna pagina de 
0258   1303               M                         BCF     STATUS,RP1      ; de memoria de programa de 2K
0259   0825           00491                                         MOVF            DECE,0                          ; mueve el reg D
                            ECE_com al registro W
025A   00B9           00492                                         MOVWF           DECE_com
                      00493                                         ;---------------------------------------------------------------
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ------------------------------------------------------------------------------------------------
025B   0DB9           00494                                         RLF             DECE_com,1
025C   0DB9           00495                                         RLF             DECE_com,1
025D   0DB9           00496                                         RLF             DECE_com,1
025E   0DB9           00497                                         RLF             DECE_com,1
                      00498                                         ;---------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
025F   0839           00499                                         MOVF            DECE_com,0              ; mueve el reg DECE_com 
                            al registro W
                      00500                                         ;---------------------------------------------------------------
                            ------------------------------------------------------------------------------------------------
0260   0606           00501                                         XORWF           PORTB,0 ; xor el registro W con con el puerto B
0261   0086           00502                                         MOVWF           PORTB           ; mueve el registro W al puerto 
                            B
0262   1C25           00503                                         BTFSS           DECE,0          ; salta si hay un '1' en el bit0
                             del registro DECE
0263   2A66           00504                                         GOTO            pon_ceroD       ; salta a etiqueta SIGUE
0264   1705           00505                                         BSF             PORTA,6 ; pon un '1' en el pin1 del PUERTO A
0265   2A67           00506                                         GOTO            terminaD
0266   1305           00507 pon_ceroD                       BCF             PORTA,6 ; pon un '0' en el pin1 del puerto A            
                                                    
0267   0008           00508 terminaD                        RETURN                                  
                      00509 ;#######################################################################################################
                            ###################
                      00510                                 END
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

ACCION_out                        0000011D
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AGUANTA_un_ms                     0000045C
AGUANTAretraso50ms                00000446
AGUANTAretraso8d                  00000421
AGUANTAretraso8i                  0000040B
ANSEL                             0000009B
AUN_SIGUE_D                       00000215
AUN_SIGUE_U                       00000209
BANCO0                            
BANCO1                            
BANCO2                            
BANCO3                            
BCDH                              00000030
BCDL                              00000031
BCD_TEMP                          00000032
BF                                00000000
BIN                               00000034
BINARIO                           0000002C
BIN_comodin                       00000035
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CICLOS60                          00000043
CIRCULOSP                         00000121
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

CIS                               00000003
CKE                               00000006
CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
CONTADOR1                         0000002D
CONTADOR2                         0000002E
CONTADOR3                         0000002F
CONTADOR_D_PULS                   00000041
CREN                              00000004
CSRC                              00000007
CUENTA                            00000044
CUENTA100                         00000033
CUENTA_SP1                        0000003A
CUENTA_SP2                        0000003B
CUENTA_SP3                        0000003C
CUENTA_SP4                        0000003D
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DECE                              00000025
DECE_com                          00000039
DEC_CUENTA                        00000021
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FINALIZA                          00000025
FREE                              00000004
FSR                               00000004
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

HAZ                               00000015
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INICIA_SP                         00000104
INICIO                            00000005
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOFS                              00000002
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NUEVE_NUEVE                       00000038
OERR                              00000001
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
OTRA_VEZ                          00000109
P                                 00000004
PCL                               00000002
PCLATH                            0000000A
PCLATH_TEMP                       0000002A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

PRECARGA                          00000444
PRECARGA_un_ms                    0000045A
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
QUITA_TIEMPO                      00000117
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
REG_REBOTE1                       0000003E
REG_REBOTE2                       0000003F
RETARDO_PULSO                     00000040
RETARDO_PULSO_com                 00000042
REVISA_CRUCEx0                    00000010
REVISA_D                          00000113
REVISA_U                          0000010F
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SALIR_AOTRO                       00000024
SCS0                              00000000
SCS1                              00000001
SEIS_CERO                         00000037
SIGUEPROG                         0000012A
SIGUE_D                           00000214
SIGUE_U                           00000208
SMP                               00000007
SP                                00000026
SPBRG                             00000099
SPEN                              00000007
SP_INTERRUPT                      00000100
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STATUS_TEMP                       00000029
SWDTE                             00000000
SWDTEN                            00000000
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1RUN                             00000006
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
T_ADQ                             00000036
UA                                00000001
UNI                               00000024
VCFG0                             00000004
VCFG1                             00000005
VUELVE_a9D                        00000211
VUELVE_a9U                        00000205
W                                 00000000
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP                            0000002B
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CCP1_RB0                         00003FFF
_CCP1_RB3                         00002FFF
_CONFIG1                          00002007
_CONFIG2                          00002008
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_EXTCLK                           00003FEF
_EXTRC_CLKOUT                     00003FFF
_EXTRC_IO                         00003FFE
_FCMEN_OFF                        00003FFE
_FCMEN_ON                         00003FFF
_HS_OSC                           00003FEE
_IESO_OFF                         00003FFD
_IESO_ON                          00003FFF
_INTRC_CLKOUT                     00003FFD
_INTRC_IO                         00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLR_OFF                         00003FDF
_MCLR_ON                          00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_WDT_OFF                          00003FFB
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

_WDT_ON                           00003FFF
_WRT_ENABLE_1024                  00003BFF
_WRT_ENABLE_512                   00003DFF
_WRT_ENABLE_OFF                   00003FFF
_XT_OSC                           00003FED
__16F88                           00000001
configura_decenas                 0000020C
configura_interrupciones          0000023D
configura_oscilador               00000231
configura_puertos                 00000236
configura_unidades                00000200
dece_comodin                      00000028
desplegar_bin_bcd                 00000243
desplegar_d_bcd                   00000257
desplegar_u_bcd                   0000024D
esp_100micros                     00000464
esp_83micros                      00000479
esp_t250_micros                   0000046B
esp_t600_micros                   00000472
esp_t_adq                         0000044E
limpia_registros                  00000218
pon_cero                          0000024B
pon_ceroD                         00000266
pon_ceroU                         00000255
retraso8333msVarDEC               00000416
retraso8333msVarINC               00000400
salidaRetrasoDEC                  0000042E
salidaRetrasoINC                  00000414
t100_micros                       00000460
t1_ms                             00000451
t250_micros                       00000467
t50msTMR0                         0000043B
t600_micros                       0000046E
t83_micros                        00000475
t_20micros                        0000044A
t_adq_20micros                    0000044A
termina                           0000024C
terminaD                          00000267
terminaU                          00000256
tmedio_s                          00000430
uni_comodin                       00000027
MPASM 03.60 Released                   INTERRUPCION_SP V7.ASM   8-12-2007  6:34:06         PAGE 24


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXX--------- ----------------
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX ----------------
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXX----

All other memory blocks unused.

Program Memory Words Used:   312
Program Memory Words Free:  3784


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    28 reported,     0 suppressed

